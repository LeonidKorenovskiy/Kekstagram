(()=>{"use strict";function e(e,t){if(e<0||t<0)return"нельзя воодить отрицательное число";if(e>t){const c=e;e=t,t=c}return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const t=document.querySelector("#picture").content.querySelector(".picture"),c=document.querySelector(".pictures"),o=document.createDocumentFragment(),s=document.querySelector("#server-problems").content.querySelector(".server-problems"),l=s.querySelector(".server-problems__button"),r=document.querySelector(".big-picture"),n=r.querySelector(".social__comments"),i=r.querySelector(".social__comments-loader"),a=[],d=()=>{const e=document.querySelectorAll(".picture").length;for(let t=0;t<e;t++){const e=document.querySelector(".picture");c.removeChild(e)}},u=e=>{e.forEach((e=>{const c=t.cloneNode(!0);c.querySelector(".picture__img").src=e.url,c.querySelector(".picture__likes").textContent=e.likes,c.querySelector(".picture__comments").textContent=e.comments.length,o.appendChild(c)})),c.appendChild(o)},m=(e,t)=>{const c=a[t].comments.length;for(let o=e;o<c&&!(o>=5)&&r.querySelectorAll(".social__comment").length!==a[t].comments.length;o++){const e=n.querySelector(".social__comment").cloneNode(!0);e.classList.add("social__comment--clone"),n.appendChild(e);const c=n.querySelectorAll(".social__comment--clone").length;e.querySelector("img").src=a[t].comments[c].avatar,e.querySelector(".social__text").textContent=a[t].comments[c].message}const o=n.querySelectorAll(".social__comment--clone").length;r.querySelector(".social__comment-count").querySelector(".visible-comments").textContent=o+1+" ",r.querySelectorAll(".social__comment").length!==a[t].comments.length||i.classList.add("hidden")};("https://22.javascript.pages.academy/kekstagram/data",fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>e.ok?e.json():Promise.reject()))).then((e=>{e.forEach(((e,t)=>{a[t]=e}))})).catch((()=>{document.querySelector("main").appendChild(s),l.addEventListener("click",(()=>{document.querySelector("main").removeChild(s)}))})).finally((()=>{console.log(a),u(a);const t=document.querySelector(".img-filters");t.classList.remove("img-filters--inactive");const c=t.querySelector("#filter-default"),o=t.querySelector("#filter-random"),s=t.querySelector("#filter-discussed");c.addEventListener("click",(()=>{d(),_.debounce(u(a),500),c.classList.add("img-filters__button--active"),o.classList.remove("img-filters__button--active"),s.classList.remove("img-filters__button--active")})),s.addEventListener("click",(()=>{const e=a.concat();e.sort(((e,t)=>e.likes>t.likes?-1:1)),d(),_.debounce(u(e),500),c.classList.remove("img-filters__button--active"),o.classList.remove("img-filters__button--active"),s.classList.add("img-filters__button--active")})),o.addEventListener("click",(()=>{const t=[],l=[];for(;l.length<10;){console.log("В вайл");let t=e(0,24);l.includes(t)||l.push(t)}l.forEach(((e,c)=>{t[c]=a[e]})),d(),_.debounce(u(t),500),c.classList.remove("img-filters__button--active"),o.classList.add("img-filters__button--active"),s.classList.remove("img-filters__button--active")}));const l=document.querySelectorAll(".picture"),y=r.querySelector(".big-picture__cancel");l.forEach(((e,t)=>{e.addEventListener("click",(()=>{r.classList.remove("hidden"),document.body.classList.add("modal-open"),m(1,t),document.querySelector(".big-picture__img").querySelector("img").src=a[t].url;const e=r.querySelector(".social__header");e.querySelector(".social__caption").textContent=a[t].description,e.querySelector(".likes-count").textContent=a[t].likes,r.querySelector(".social__comment-count").querySelector(".comments-count").textContent=a[t].comments.length,n.querySelector(".social__text").textContent=a[t].comments[0].message,n.querySelector(".social__picture").src=a[t].comments[0].avatar;const c=()=>{document.querySelectorAll(".social__comment").length!==a[t].comments.length&&m(0,t)};i.addEventListener("click",c),y.addEventListener("click",(()=>{i.removeEventListener("click",c),r.classList.add("hidden"),document.body.classList.remove("modal-open"),i.classList.remove("hidden"),(()=>{const e=n.querySelectorAll(".social__comment--clone");for(let t=0;t<e.length;t++){const e=n.querySelector(".social__comment--clone");n.removeChild(e)}})()}))}))}))}));const y=document.querySelector(".text__description"),v=document.querySelector(".text__hashtags");y.addEventListener("input",(()=>{y.value.length>140?y.setCustomValidity("Вы превысили максимальное количество симовлов. Максимум 140"):y.setCustomValidity(""),y.reportValidity()}));const p=/^#/,S=/^#[a-zа-я0-9]{1,19}(\s)?((#[a-zа-я0-9]{1,19})?(\s)?){0,4}$/iu;v.addEventListener("input",(()=>{const e=v.value.length;""==v.value?(v.setCustomValidity(""),v.style.border="2px solid black"):p.test(v.value)?/[a-z0-9а-я#\s]/iu.test(v.value[e-1])?S.test(v.value)?(v.setCustomValidity(""),v.style.border="2px solid black"):(v.setCustomValidity("ХэшТег должнет быть не меньше 1 и не больше 20-ти смволов"),console.log("больше 20"),v.style.border="2px solid red"):(v.setCustomValidity("ХэшТег не можетт содержать данный символ"),v.style.border="2px solid red"):(v.setCustomValidity("Ошибка, необходимо добавить #"),v.style.border="2px solid red"),v.reportValidity()}));const h=document.querySelector("#effect-none"),q=document.querySelector("#effect-chrome"),g=document.querySelector("#effect-sepia"),L=document.querySelector("#effect-marvin"),f=document.querySelector("#effect-phobos"),k=document.querySelector("#effect-heat"),b=document.querySelector(".img-upload__preview").querySelector("img"),E=document.querySelector(".effect-level__slider");let C=document.querySelector(".effect-level__value");noUiSlider.create(E,{range:{min:0,max:100},start:100,step:1,connect:"lower"});const x=()=>{b.className="",b.style.filter="",E.classList.add("hidden"),A.value=100,document.querySelector(".img-upload__preview").style.transform="scale(1)",h.checked=!0,y.value="",v.value=""};E.classList.add("hidden"),h.addEventListener("click",(()=>{b.className="",b.style.filter="",E.classList.add("hidden")})),q.addEventListener("click",(()=>{b.className="",b.classList.add("effects__preview--chrome"),w(0,1,.1,"grayscale")})),g.addEventListener("click",(()=>{b.className="",b.classList.add("effects__preview--sepia"),w(0,1,.1,"sepia")})),L.addEventListener("click",(()=>{b.className="",b.classList.add("effects__preview--marvin"),w(1,100,1,"invert","%")})),f.addEventListener("click",(()=>{b.className="",b.classList.add("effects__preview--phobos"),w(1,3,.1,"blur","px")})),k.addEventListener("click",(()=>{b.className="",b.classList.add("effects__preview--heat"),w(1,3,.1,"brightness")}));const w=(e,t,c,o,s="")=>{E.classList.remove("hidden"),E.noUiSlider.updateOptions({range:{min:e,max:t},start:t,step:c,connect:"lower"}),E.noUiSlider.on("update",((e,t,c)=>{const l=c[t];C.value=l,b.style.filter=o+"("+l+s+")",console.log(l)}))},N=document.querySelector(".img-upload__overlay"),V=document.querySelector(".img-upload__input");let A=document.querySelector(".scale__control--value");const j=document.querySelector(".scale__control--smaller"),I=document.querySelector(".scale__control--bigger"),M=document.querySelector(".img-upload__form"),z=document.querySelector("#success").content.querySelector(".success"),D=z.querySelector(".success__button"),P=document.querySelector("#error").content.querySelector(".error"),U=P.querySelector(".error__button");M.addEventListener("submit",(e=>{var t;e.preventDefault(),alert("Отправили"),(t=M,fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:new FormData(t)}).then((e=>e.ok?(console.log("Форма ушла"),e.json()):Promise.reject()))).then((e=>{N.classList.add("hidden"),z.classList.remove("hidden"),document.querySelector("main").appendChild(z),D.addEventListener("click",(()=>{z.classList.add("hidden")})),document.addEventListener("keydown",(function(e){"Escape"!==e.key&&"ESC"!==e.key||z.classList.add("hidden")})),document.addEventListener("mousedown",(function(e){null===e.target.closest(".success__inner")&&(console.log("Клик не в попапе"),z.classList.add("hidden"))})),document.querySelector(".img-upload__input").value="",x()})).catch((e=>{N.classList.add("hidden"),P.classList.remove("hidden"),document.querySelector("main").appendChild(P),U.addEventListener("click",(()=>{P.classList.add("hidden")})),document.addEventListener("keydown",(function(e){"Escape"!==e.key&&"ESC"!==e.key||P.classList.add("hidden")})),document.addEventListener("mousedown",(function(e){null===e.target.closest(".error__inner")&&P.classList.add("hidden")})),document.querySelector(".img-upload__input").value="",x()}))})),V.addEventListener("change",(()=>{N.classList.remove("hidden"),document.body.classList.add("modal-open")})),document.querySelector(".img-upload__cancel").addEventListener("click",(()=>{N.classList.add("hidden"),document.body.classList.remove("modal-open")})),document.addEventListener("keydown",(e=>{v==document.activeElement||y==document.activeElement?N.classList.remove("hidden"):"Escape"!==e.key&&"ESC"!==e.key||(N.classList.add("hidden"),document.querySelector(".img-upload__input").value="")})),j.addEventListener("click",(()=>{parseInt(A.value)<=25||(A.value=parseInt(A.value)-25+"%",document.querySelector(".img-upload__preview").style.transform=`scale(${parseInt(A.value)/100})`)})),I.addEventListener("click",(()=>{parseInt(A.value)>=100||(A.value=parseInt(A.value)+25+"%",document.querySelector(".img-upload__preview").style.transform=`scale(${parseInt(A.value)/100})`)}))})();
//# sourceMappingURL=main-bundle.js.map